From 26b9c6ccdea9b029ebdf26a05853d442eaee6765 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Julian=20R=C3=BCth?= <julian.rueth@fsfe.org>
Date: Mon, 7 Oct 2019 19:24:07 +0200
Subject: [PATCH] Add conda prefix to search paths

---
 python/cppyy/__init__.py       | 5 +++++
 python/cppyy/_cpython_cppyy.py | 6 +++++-
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/python/cppyy/__init__.py b/python/cppyy/__init__.py
index 131d857..8e8350f 100644
--- a/python/cppyy/__init__.py
+++ b/python/cppyy/__init__.py
@@ -203,6 +203,11 @@ if not ispypy:
         else:
             add_include_path(apipath_extra)
 
+# assuming that we are in PREFIX/lib/python/site-packages/cppyy, add
+# PREFIX/include to the search path
+include_path = os.path.abspath(os.path.join(os.path.dirname(__file__), '..', '..', '..', '..', 'include'))
+if os.path.exists(include_path): add_include_path(include_path)
+
 del ispypy, apipath
 
 def add_autoload_map(fname):
diff --git a/python/cppyy/_cpython_cppyy.py b/python/cppyy/_cpython_cppyy.py
index 0a333e3..5709648 100644
--- a/python/cppyy/_cpython_cppyy.py
+++ b/python/cppyy/_cpython_cppyy.py
@@ -100,8 +100,12 @@ gbl.std.move  = _backend.move
 #- add to the dynamic path as needed -----------------------------------------
 import os
 def add_default_paths():
+    gSystem = gbl.gSystem
+    # assuming that we are in PREFIX/lib/python/site-packages/cppyy, add
+    # PREFIX/lib to the search path
+    lib = os.path.abspath(os.path.join(os.path.dirname(__file__), '..', '..', '..'))
+    if os.path.exists(lib): gSystem.AddDynamicPath(lib)
     try:
-        gSystem = gbl.gSystem
         with open('/etc/ld.so.conf') as ldconf:
             for line in ldconf:
                 f = line.strip()
-- 
2.23.0

